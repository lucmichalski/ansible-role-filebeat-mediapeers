# vim:ft=ansible:
#===============================================================================
#
# Filebeat Configuration
#
#-------------------------------------------------------------------------------
#
# {{ ansible_managed }}
#
#===============================================================================


########################### Filebeat inputs ####################################
# List of filebeat inputs. Each input references at least one path and has bunch
# of other params.

filebeat.inputs:
{% for prospector in filebeat_all_prospectors %}
    -
      {{ prospector|to_nice_yaml|indent(6) }}

{% endfor %}

############################# Filebeat modules #################################
# Filebeat modules, a package of log input configuration. Enable here

filebeat.modules:
{% for module in filebeat_modules %}
    -
      {{ module|to_nice_yaml|indent(6) }}

{% endfor %}

############################# Processors #######################################
# Configure processors to enhance or manipulate events generated by the beat.
processors:
{% if filebeat_machine_metadata  %}
  - add_cloud_metadata: ~
  - add_host_metadata: ~
{% endif %}

############################# Outputs ##########################################

# Configure what outputs to use when sending the data collected by the beat.
# Multiple outputs may be used.
output:

  ### Logstash as output
  logstash:
    # The Logstash hosts
    hosts: ["{{filebeat_logstash_server}}:{{filebeat_logstash_server_port}}"]

    # Number of workers per Logstash host.
    #worker: 1

    # Optional load balance the events between the Logstash hosts
    #loadbalance: true

    # Optional index name. The default index name depends on the each beat.
    # For Packetbeat, the default is set to packetbeat, for Topbeat
    # top topbeat and for Filebeat to filebeat.
    #index: filebeat

{% if filebeat_logstash_tls %}
    # Optional TLS. By default is off.
    ssl:
      {% if filebeat_logstash_tls_certificate_authorities %}
      # List of root certificates for HTTPS server verifications
      certificate_authorities:
        {{ filebeat_logstash_tls_certificate_authorities | to_nice_yaml | indent(8) }}
      {% endif %}

      {% if filebeat_logstash_tls_certificate %}
      # Certificate for TLS client authentication
      certificate: {{ filebeat_logstash_tls_certificate }}
      {% endif %}

      {% if filebeat_logstash_tls_certificate_key %}
      # Client Certificate Key
      key: {{ filebeat_logstash_tls_certificate_key }}
      {% endif %}
{% endif %}

############################# Filebeat logging #######################################

# There are three options for the log ouput: syslog, file, stderr.
# Under Windos systems, the log files are per default sent to the file output,
# under all other system per default to syslog.
logging:

  # Send all logging output to syslog. On Windows default is false, otherwise
  # default is true.
  #to_syslog: true

  # Write all logging output to files. Beats automatically rotate files if rotateeverybytes
  # limit is reached.
  to_files: true

  # To enable logging to files, to_files option has to be set to true
  files:
    # The directory where the log files will written to.
    path: /var/log/filebeat

    # The name of the files where the logs are written to.
    #name: mybeat

    # Configure log file size limit. If limit is reached, log file will be
    # automatically rotated
    rotateeverybytes: 10485760 # = 10MB

    # Number of rotated log files to keep. Oldest files will be deleted first.
    keepfiles: 5

  # Enable debug output for selected components. To enable all selectors use ["*"]
  # Other available selectors are beat, publish, service
  # Multiple selectors can be chained.
  #selectors: [ ]

  # Sets log level. The default log level is error.
  # Available log levels are: critical, error, warning, info, debug
  level: error

